# 인터럽트, 시스템 콜

## 인터럽트(Interrupt)

* CPU가 프로그램을 실행하고 있을 때, 입출력 하드웨어 등의 장치나 예외 상황이 발생하여 처리가 필요한 경우에 CPU에게 알리는 일종의 이벤트를 뜻한다.
* 인터럽트 당한 시점의 레지스터와 프로그램 카운터를 저장한 후 CPU의 제어를 인터럽트 처리 루틴에 넘긴다.

### Interrupt (넓은 의미)

* interrupt(하드웨어 인터럽트) : 하드웨어가 발생시킨 인터럽트
* Trap(소프트웨어 인터럽트)
    * Exception : 프로그램이 오류를 범한 경우
    * System call : 프로그램이 커널 함수를 호출하는 경우

일반적인 의미의 인터럽트는 하드웨어 인터럽트이지만 둘다 말하면 넓은 의미의 인터럽트이다.

</br>

### 인터럽트 벡처

인터럽트 종류마다 번호를 정해서 번호에 따라 처리해야할 코드가 위치한 부분을 가리키고 있는 자료구조를 말한다.

> 운영체제는 할일을 쉽게 찾아가기 위해 인터럽트 벡터를 가지고 있다. 

</br>

### 인터럽트 처리 루틴 (Interrupt Service Routine, 인터럽트 핸들러)

인터럽트 벡터에서 실제 처리해야 할 코드를 인터럽트 처리 루틴 혹은 인터럽트 핸들러라고 부른다. </br>
즉, 해당 인터럽트를 처리하는 커널 함수를 의미한다.

> 인터럽트 처리 루틴을 통해 해당하는 인터럽트 처리를 완료하고 나면 원래 수행하던 작업으로 돌아갈 위치를 알아야하므로 인터럽트 처리전에 수행 중이던 작업이 무엇이었는지 반드시 저장해야하는데, 이러한 정보를 저장하기 위해 운영체제는 PCB라는 공간을 별도로 가지고 있다.

</br>

### I/O를 하기 위해서 필요한 인터럽트는 무엇일까?

I/O 요청을 할 때는 소프트웨어 인터럽트로 할 것이고, I/O가 다 끝나면 하트웨어 인터럽트를 사용한다.

CPU를 특정 프로그램이 독점하는 것을 막기 위한 것을 timer interrupt 라고하고, 요청한 I/O가 다 끝났다는 것을 알려주는 것은 I/O Controller가 인터럽트를 걸어서 알려주게 된다.

> 현재의 운영체제는 인터럽트에 의해 구동된다.

</br>

## 시스템 콜(system call)

![image](https://user-images.githubusercontent.com/75905803/204191739-70dada23-fbb9-4fff-92f9-d6692c10b81b.png)

시스템 콜은 운영체제에게 I/O를 요청하는 것을 말한다. </br>
사용자 프로그램이 운영체제의 서비스를 받기 위해 커널 함수를 호출하는 것이라고 생각하면 된다.

> 일반적인 함수는 사용자 프로그램이 자기가 할당 된 메모리 내에서 주소를 바꿔가면서 실행이 되지만, I/O 요청은 사용자 프로그램 메모리를 벗어난 OS의 메모리에 요청을 보내야하기 때문에 직접적으로 점프를 하는 것이 불가능하다. 그렇기 때문에 사용자 프로그램은 소프트웨어적으로, CPU에게 I/O 요청이 있음을 interrupt 신호를 보낸다. 이 인터럽트 신호를 받은 CPU는 인터럽트가 왔기 때문에 mode bit을 0으로 전환후 OS 모드를 실행한다.

</br>

### 시스템 콜을 사용하는 예시

* 입출력(I/O)의 수행
    * 모든 입출력 명령은 특권 명령
    * 사용자 프로그램은 어떻게 I/O를 하는가?
        * 시스템콜(system call)
            * 사용자 프로그램은 운영체제에게 I/O 요청
        * trap을 사용하여 인터럽트 벡터의 특정 위치로 이동
        * 제어권이 인터럽트 벡터가 가리키는 인터럽트 서비스 루틴으로 이동
        * 올바른 I/O 요청인지 확인 후 I/O 수행
        * I/O 완료 시 제어권을 시스템콜 다음 명령으로 옮김
