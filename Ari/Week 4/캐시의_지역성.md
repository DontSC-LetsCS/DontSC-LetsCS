# 캐시의 지역성

## 캐시 메모리(Cache Memory)란?

![](https://i.imgur.com/OcvyzaU.png)

* 주기억 장치에서 자주 사용되는 프로그램과 데이터를 저장해두어 속도를 빠르게 하는 메모리
    * 그러므로 캐시는 주 기억장치보다 크기가 작을 수 밖에 없다.
    * 캐시 기억장치와 주기억장치 사이에서 정보를 옮기는 것을 사상(Mapping)이라고 함
* 속도가 빠른 장치와 느린 장치간의 속도차에 따른 병목 현상을 줄이기 위한 범용 메모리
    * 이를 위해서는 CPU가 어떤 데이터를 원하는지 어느정도 예측할 수 있어야 한다.
    * 캐시 메모리에 CPU가 이후에 참조할, 필요있는 정보가 어느정도 들어있느냐에 따라 캐시의 성능이 좌우되기 때문
* 주기억 장치와 CPU 사이에 위치
    * 메모리 계층 구조에서 가장 빠른 소자이며, 처리속도가 거의 CPU와 비슷할 정도의 속도를 가지고 있다.
    * 캐시 메모리를 사용하면 주기억장치를 접근하는 횟수가 줄어들어 컴퓨터의 처리속도가 향상한다.
    * 캐시의 크기는 수십 KByte - 수백 KByte

</br>

## 캐시의 지역성이란?

* 캐시가 효율적으로 동작하려면 캐시의 적중율(Hit-rate)를 극대화 시켜야 한다.
* 캐시에 저장할 데이터가 지역성(Locality)을 가져야 한다.
* 지역성이란 데이터 접근이 시간적, 공간적으로 가깝게 일어나는 것을 의미한다.
* 지역성의 전제조건으로 프로그램은 모든 코드나 데이터를 균등하게 Access하지 않는다는 특성을 기본으로 한다.

즉 지역성(Locality이란 기억 장치 내의 정보를 균일하게 액세스하는 것이 아닌 어느 한 순간에 특정부분을 집중적으로 참조하는 특성이다.

</br>

## 지역성(Locality)의 종류

* `시간적 지역성`
    * 최근에 참조된 주소의 내용은 곧 다음에 다시 참조되는 특성
    * 특정 데이터가 한번 접근되었을 경우 가까운 미래에 또 한번 데이터에 접근할 가능성이 높은 것
    * 메모리 상의 같은 주소에 여러차례 읽기 쓰기를 수행할 경우 상대적으로 작은 크기의 캐시를 사용해도 효율성을 꾀할 수 있다.
* `공간적 지역성`
    * 대부분의 실제 프로그램이 참조된 주소와 인접한 주소의 내용이 다시 참조되는 특성
    * 특정 데이터와 가까운 주소가 순서대로 접근되었을 경우 CPU 캐시나 디스크 캐시의 경우 한 메모리 주소에 접근할 때, 그 주소뿐 아니라 해당 블록을 전부 캐시에 가져오게 된다.
    * 이때 메모리 주소를 오름차순이나 내림차순으로 접근한다면 캐시에 이미 저장된 같은 블록의 데이터를 접근하게 되므로 캐시의 효율성이 크게 향상된다.

</br>

## Caching line

앞서 언급 했듯이 캐시는 프로세서 가까이에 위치하면서 빈번하게 사용되는 데이터를 놔두는 장소이다. 하지만 캐시가 아무리 가까이 있더라도 찾고자하는 데이터가 어느 곳에 저장되어 있는지 몰라 모든 데이터를 순회해야 한다면, 시간이 오래 걸리게 된다.</br>
즉, 캐시에 목적 데이터가 저장되어있다면 바로 접근하여 출력할 수 있어야 캐시가 의미있어진다는 것이다.
</br>
그렇기 때문에 캐시에 데이터를 저장할 때 특정 자료구조를 사용하여 묶음으로 저장하게 되는데, 이를 캐싱 라인이라고 한다.
</br>
프로세스는 다양한 주소에 있는 데이터를 사용하므로 빈번하게 사용되는 데이터의 주소 또한 흩어져있다. 따라서 캐시에 저장하는 데이터는 데이터의 메모리 주소 등을 기록해 둔 태그를 달아놓을 필요가 있다.
</br>
이러한 태그들의 묶음을 캐싱 라인이라고 하고 메모리로부터 가져올 때도 캐싱 라인을 기준으로 가져온다.
</br>
종류는 대표적으로 세 가지 방식이 존재한다.

* 직접 매핑(Direct mapping)
    * 주기억장치의 블록들이 지정된 한개의 캐시 라인으로만 사상될 수 있는 방법
    * 간단하고 구현하는 비용이 적게드는 장점이 있지만 적중률이 낮아질 수 있는 단점이 있다.
* 어소시에이티브 매핑(Associative mapping)
    * 직접 매핑 단점을 보완한 방식
    * 모든 태그들을 병렬로 검사하기 때문에 복잡하고 비용이 높다는 단점이 있어 거의 사용하지 않는다.
* 세트-어소시에이티브 매핑(Set-associative mapping)
    * 직접 매핑과 연관 매핑의 장점만을 취한 방식이다.
